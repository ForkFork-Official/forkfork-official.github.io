<!DOCTYPE html>
<html>
<head>
    <title>ForkFork - Add Friend</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
        function detectAppAndRedirect() {
            let appOpened = false;
            let redirectTimer;
            let startTime = Date.now();
            
            // Function to handle app opening detection
            function handleVisibilityChange() {
                if (document.hidden || document.webkitHidden) {
                    // Page became hidden, likely app opened
                    appOpened = true;
                    clearTimeout(redirectTimer);
                }
            }
            
            function handlePageHide() {
                // Page is being unloaded, likely app opened
                appOpened = true;
                clearTimeout(redirectTimer);
            }
            
            function handleBlur() {
                // Window lost focus, likely app opened
                appOpened = true;
                clearTimeout(redirectTimer);
            }
            
            function handleFocus() {
                // Check if we came back to the page quickly (app didn't open)
                const timeElapsed = Date.now() - startTime;
                if (timeElapsed < 1000 && !appOpened) {
                    // Came back quickly, app probably not installed
                    clearTimeout(redirectTimer);
                    redirectTimer = setTimeout(function() {
                        if (!appOpened) {
                            window.location.href = "https://apps.apple.com/kr/app/forkfork/id6744844399?l=en-GB";
                        }
                    }, 1000);
                }
            }
            
            // Add event listeners for app detection
            document.addEventListener('visibilitychange', handleVisibilityChange);
            document.addEventListener('webkitvisibilitychange', handleVisibilityChange);
            window.addEventListener('pagehide', handlePageHide);
            window.addEventListener('blur', handleBlur);
            window.addEventListener('focus', handleFocus);
            
            // Try to open the app using custom URL scheme
            const deviceID = new URLSearchParams(window.location.search).get('deviceID');
            const customSchemeURL = `forkfork://addfriend${deviceID ? '?deviceID=' + deviceID : ''}`;
            
            // Use window.location.href to try opening the app
            try {
                window.location.href = customSchemeURL;
            } catch (e) {
                // If there's an error, app is probably not installed
                console.log('Error opening app:', e);
            }
            
            // Set timer to redirect to App Store if app doesn't open
            redirectTimer = setTimeout(function() {
                if (!appOpened) {
                    // App didn't open, redirect to App Store
                    window.location.href = "https://apps.apple.com/kr/app/forkfork/id6744844399?l=en-GB";
                }
            }, 3000);
        }
        
        // Prevent multiple executions
        let executed = false;
        
        // Run detection when page loads
        window.onload = function() {
            if (!executed) {
                executed = true;
                detectAppAndRedirect();
            }
        };
        
        // Also try on DOMContentLoaded in case onload doesn't fire
        document.addEventListener('DOMContentLoaded', function() {
            if (!executed) {
                executed = true;
                detectAppAndRedirect();
            }
        });
    </script>
</head>
<body>
    <h1>Opening ForkFork...</h1>
    <p>If the app doesn't open automatically, <a href="https://apps.apple.com/kr/app/forkfork/id6744844399?l=en-GB">click here</a> to download ForkFork from the App Store.</p>
</body>
</html>
