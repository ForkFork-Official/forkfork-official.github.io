<!DOCTYPE html>
<html>
<head>
    <title>ForkFork - Add Friend</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
        function detectAppAndRedirect() {
            let appOpened = false;
            let redirectTimer;
            
            // Function to handle app opening detection
            function handleVisibilityChange() {
                if (document.hidden || document.webkitHidden) {
                    // Page became hidden, likely app opened
                    appOpened = true;
                    clearTimeout(redirectTimer);
                }
            }
            
            function handlePageHide() {
                // Page is being unloaded, likely app opened
                appOpened = true;
                clearTimeout(redirectTimer);
            }
            
            function handleBlur() {
                // Window lost focus, likely app opened
                appOpened = true;
                clearTimeout(redirectTimer);
            }
            
            // Add event listeners for app detection
            document.addEventListener('visibilitychange', handleVisibilityChange);
            document.addEventListener('webkitvisibilitychange', handleVisibilityChange);
            window.addEventListener('pagehide', handlePageHide);
            window.addEventListener('blur', handleBlur);
            
            // Try to open the app using custom URL scheme
            const deviceID = new URLSearchParams(window.location.search).get('deviceID');
            const customSchemeURL = `forkfork://addfriend${deviceID ? '?deviceID=' + deviceID : ''}`;
            
            // Create invisible iframe to try opening the app
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = customSchemeURL;
            document.body.appendChild(iframe);
            
            // Set timer to redirect to App Store if app doesn't open
            redirectTimer = setTimeout(function() {
                if (!appOpened) {
                    // App didn't open, redirect to App Store
                    window.location.href = "https://apps.apple.com/kr/app/forkfork/id6744844399?l=en-GB";
                }
            }, 2500);
            
            // Clean up iframe after attempt
            setTimeout(function() {
                if (iframe.parentNode) {
                    iframe.parentNode.removeChild(iframe);
                }
            }, 1000);
        }
        
        // Run detection when page loads
        window.onload = detectAppAndRedirect;
    </script>
</head>
<body>
    <h1>Opening ForkFork...</h1>
    <p>If the app doesn't open automatically, <a href="https://apps.apple.com/kr/app/forkfork/id6744844399?l=en-GB">click here</a> to download ForkFork from the App Store.</p>
</body>
</html>
